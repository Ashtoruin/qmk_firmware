#include QMK_KEYBOARD_H
#include "rbernau.h"

#if (!defined(LAYOUT) && defined(KEYMAP))
#    define LAYOUT KEYMAP
#endif

#define LAYOUT_5x7_wrapper(...) LAYOUT_5x7(__VA_ARGS__)

// Layer Declarations
enum layer_number {
  _QWERTY,
  _DVORAK,
  _COLEMAK,
  _FUNCTION,
  _LAYER,
};

// Custom Keycodes
enum custom_keycodes {
  PL_QWRT = SAFE_RANGE,
  PL_DVRK,
  PL_CLMK,
  PL_BASC,
};

#define MO_FUNC MO(_FUNCTION)
#define MO_LAYR MO(_LAYER)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_QWERTY] = LAYOUT_5x7_wrapper(
    // left hand
    KC_GESC, ________________NUMBERS_L___________________________,
    KC_TAB , ________________QWERTY_L1__________________, KC_MINS,
    KC_LCTL, ________________QWERTY_L2__________________, _______,
    KC_LSFT, ________________QWERTY_L3__________________,
    KC_CAPS, KC_LGUI, KC_LALT, MO_LAYR,
                               KC_BSPC, KC_SPC ,
                                        KC_END , KC_HOME,
                                        KC_PSCR, KC_INS ,
    // right hand
    ________________NUMBERS_R___________________________, _______,
    KC_EQL , ________________QWERTY_R1__________________, KC_BSLS,
    _______, ________________QWERTY_R2__________________, KC_RCTL,
             ________________QWERTY_R3__________________, KC_RSFT,
                               KC_LEFT, KC_UP  , KC_DOWN, KC_RGHT,
                      KC_BSPC, MO_FUNC,
             KC_PGUP, KC_INS ,
             KC_PGDN, _______),

  [_DVORAK] = LAYOUT_5x7_wrapper(
    // left hand
    _______, ________________NUMBERS_L___________________________,
    _______, ________________DVORAK_L1__________________, _______,
    _______, ________________DVORAK_L2__________________, _______,
    _______, ________________DVORAK_L3__________________,
    _______, _______, _______, _______,
                               _______, _______,
                                        _______, _______,
                                        _______, _______,
    // right hand
    ________________NUMBERS_R_DVORAK____________________, _______,
    _______, ________________DVORAK_R1__________________, _______,
    _______, ________________DVORAK_R2__________________, _______,
             ________________DVORAK_R3__________________, _______,
                               _______, _______, _______, _______,
                      _______, _______,
             _______, _______,
             _______, _______),

  [_COLEMAK] = LAYOUT_5x7_wrapper(
    // left hand
    _______, ________________NUMBERS_L___________________________,
    _______, ________________COLEMAK_L1_________________, _______,
    _______, ________________COLEMAK_L2_________________, _______,
    _______, ________________COLEMAK_L3_________________,
    _______, _______, _______, _______,
                               _______, _______,
                                        _______, _______,
                                        _______, _______,
    // right hand
    ________________NUMBERS_R___________________________, _______,
    _______, ________________COLEMAK_R1_________________, _______,
    _______, ________________COLEMAK_R2_________________, _______,
             ________________COLEMAK_R3_________________, _______,
                               _______, _______, _______, _______,
                      _______, _______,
             _______, _______,
             _______, _______),

  [_FUNCTION] = LAYOUT_5x7_wrapper(
    // left hand
    KC_GRV , ________________FUNCTION_L__________________________,
    _______, _______, KC_UP  , _______, _______, _______, _______,
    _______, KC_LEFT, KC_DOWN, KC_RGHT, _______, _______, _______,
    _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______,
                               _______, _______,
                                        _______, _______,
                                        _______, _______,
    // right hand
    ________________FUNCTION_R__________________________, _______,
    _______, _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______,
             _______, _______, _______, _______, _______, _______,
                               _______, _______, _______, _______,
                      _______, _______,
             _______, _______,
             _______, _______),

  [_LAYER] = LAYOUT_5x7_wrapper(
    // left hand
    RESET  , PL_QWRT, PL_DVRK, PL_CLMK, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______,
                               _______, _______,
                                        _______, _______,
                                        _______, _______,
    // right hand
    _______, _______, _______, _______, _______, _______, RESET  ,
    _______, _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______,
             _______, _______, _______, _______, _______, _______,
                               _______, _______, _______, _______,
                      _______, _______,
             _______, _______,
             _______, _______)
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch (keycode) {
    case PL_QWRT:
      if (record->event.pressed) {
        set_single_persistent_default_layer(_QWERTY);
      }
      break;
    case PL_DVRK:
      if (record->event.pressed) {
        set_single_persistent_default_layer(_DVORAK);
      }
      break;
    case PL_CLMK:
      if (record->event.pressed) {
        set_single_persistent_default_layer(_COLEMAK);
      }
      break;
  }
  return true;
}
